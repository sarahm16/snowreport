const { client, resolvePath, writeStream } = require('./base')

const clientOptions = {
  dataType: 'stream',
}

const castEid = 'Opt5S8PjwKwnVSHdJDoj'

const outputPath = resolvePath(__dirname, `fill-${castEid}.pdf`)

const payloadNormal = {
  data: {
    introTop: 'Intro on the Top',
    introBottom: 'Intro on the Bottom',
    office: ['MAIN OFFICE', 'SATELLITE OFFICE'],
    items: [
      ['Main Item 1', 'Main Item 2', 'Main Item 3', 'Main Item 4', 'Main Item 5'],
      ['Satellite Item 1', 'Satellite Item 2', 'Satellite Item 3', 'Satellite Priceless Item'],
    ],
    prices: [
      ['$100', '$200', '$300', '$400', '$500'],
      ['$100', '$200', '$300'],
    ],
    outroTop: 'Outro on the Top',
    outroBottom: 'Outro on the Bottom',
  },
}

const payloadCray = {
  data: {
    introTop: 'Intro on the Top',
    introBottom: 'Intro on the Bottom',
    office: ['MAIN OFFICE', 'SATELLITE OFFICE'],
    items: [
      ['Main Item 1', 'Main Item 2', 'Main Item 3', 'Main Item 4', 'Main Item 5'],
      ['Satellite Item 1', 'Satellite Item 2', 'Satellite Item 3', 'Satellite Priceless Item'],
    ],
    prices: [
      ['$100', '$200', '$300', '$400', '$500'],
      ['$100', '$200', '$300'],
    ],
    outroTop: ['Outro on the Top 1', 'Outro on the Top 2'],
    outroBottom: ['Outro on the Bottom 1', 'Outro on the Bottom 2'],
  },
}

const payloadWithNullsAndEmpties = {
  data: {
    introTop: null,
    introBottom: 'Intro Bottom',

    office: null,

    items: [
      ['', 'Main Item 2', undefined, null, 'Main Item 5'],
      [null, 'Satellite Item 2', 'Satellite Item 3', 'Satellite Priceless Item'],
    ],
    prices: [
      ['$100', '', null, '$400', '$500'],
      [undefined, '$200', '$300'],
    ],

    outroTop: 'Outro Top',
    outroBottom: '',
  },
}

const errorPayload = {
  data: {
    introTop: 'Intro on the Top',
    introBottom: 'Intro on the Bottom',
    office: ['MAIN OFFICE', 'SATELLITE OFFICE'],
    items: [
      'Main Item 1', 'Main Item 2', 'Main Item 3', 'Main Item 4', 'Main Item 5',
      'Satellite Item 1', 'Satellite Item 2', 'Satellite Item 3', 'Satellite Priceless Item',
    ],
    prices: [
      '$100', '$200', '$300', '$400', '$500',
      '$100', '$200', '$300',
    ],
    outroTop: ['Outro on the Top 1', 'Outro on the Top 2'],
    outroBottom: ['Outro on the Bottom 1', 'Outro on the Bottom 2'],
  },
}

let payload
payload = payloadNormal
// payload = payloadCray
// payload = payloadWithNullsAndEmpties
// payload = errorPayload

async function main () {
  const { statusCode, data, errors } = await client.fillPDF(castEid, payload, clientOptions)
  if (data) {
    await writeStream({ data, path: outputPath })
  } else {
    console.log({ statusCode, data, errors })
  }

  return outputPath
}

main()
  .then(console.log)
  .catch(console.warning)

const config = {
  "fields": [
    {
      "id": "castbc7a10009d5111ebb14a83c829c69143",
      "icon": "IconText",
      "name": "Intro Top",
      "rect": [
        [24.36, 759.94],
        [133.81, 759.94],
        [133.81, 719.24],
        [24.36, 719.24]
      ],
      "type": "shortText",
      "aliasId": "introTop",
      "pageNum": 0
    },
    {
      "id": "castcf007e809d5111ebb14a83c829c69143",
      "icon": "IconText",
      "name": "Intro Bottom",
      "rect": [
        [426.7, 82.88],
        [559.9, 82.88],
        [559.9, 35.71],
        [426.7, 35.71]
      ],
      "type": "shortText",
      "aliasId": "introBottom",
      "pageNum": 0
    },
    {
      "id": "cast022d56c0a3a111eba178fd84dbfb5d45",
      "icon": "IconText",
      "name": "Intro Page Numbering",
      "rect": [
        [440.18, 766.5],
        [513.03, 766.5],
        [513.03, 748.9],
        [440.18, 748.9]
      ],
      "type": "shortText",
      "aliasId": "pageNumbering",
      "pageNum": 0
    },
    {
      "id": "cast1e6f60d0a3a111eba178fd84dbfb5d45",
      "icon": "IconText",
      "name": "Intro Repeat Numbering",
      "rect": [
        [529.43, 769.54],
        [602.89, 769.54],
        [602.89, 752.53],
        [529.43, 752.53]
      ],
      "type": "shortText",
      "aliasId": "repeatNumbering",
      "pageNum": 0
    },
    {
      "id": "cast06725f509d5211ebb14a83c829c69143",
      "name": "Items",
      "type": "array",
      "aliasId": "items",
      "children": [
        {
          "id": "items.one",
          "icon": "IconText",
          "name": "Items 1",
          "rect": [
            [22.32, 667.01],
            [109.81, 667.01],
            [109.81, 635.76],
            [22.32, 635.76]
          ],
          "type": "shortText",
          "pageNum": 1
        },
        {
          "id": "items.two",
          "icon": "IconText",
          "name": "Items 2",
          "rect": [
            [20.98, 620.59],
            [108.47, 620.59],
            [108.47, 590.23],
            [20.98, 590.23]
          ],
          "type": "shortText",
          "pageNum": 1
        }
      ]
    },
    {
      "id": "cast0f6246709d5211ebb14a83c829c69143",
      "name": "Prices",
      "type": "array",
      "aliasId": "prices",
      "children": [
        {
          "id": "prices.one",
          "icon": "IconText",
          "name": "Prices 1",
          "rect": [
            [148.65, 665.23],
            [216.5, 665.23],
            [216.5, 633.53],
            [148.65, 633.53]
          ],
          "type": "shortText",
          "pageNum": 1
        },
        {
          "id": "prices.two",
          "icon": "IconText",
          "name": "Prices 2",
          "rect": [
            [145.52, 618.35],
            [216.05, 618.35],
            [216.05, 588],
            [145.52, 588]
          ],
          "type": "shortText",
          "pageNum": 1
        }
      ]
    },
    {
      "id": "cast13c1d0009d5211ebb14a83c829c69143",
      "icon": "IconText",
      "name": "Office",
      "rect": [
        [24.11, 758.52],
        [122.31, 758.52],
        [122.31, 721.47],
        [24.11, 721.47]
      ],
      "type": "shortText",
      "aliasId": "office",
      "pageNum": 1
    },
    {
      "id": "cast022d56c0a3a111eba178fd84dbfb5d47",
      "icon": "IconText",
      "name": "Repeatable Page Numbering",
      "rect": [
        [440.18, 766.5],
        [513.03, 766.5],
        [513.03, 748.9],
        [440.18, 748.9]
      ],
      "type": "shortText",
      "aliasId": "pageNumbering",
      "pageNum": 1
    },
    {
      "id": "cast1e6f60d0a3a111eba178fd84dbfb5d47",
      "icon": "IconText",
      "name": "Repeatable Repeat Numbering",
      "rect": [
        [529.43, 769.54],
        [602.89, 769.54],
        [602.89, 752.53],
        [529.43, 752.53]
      ],
      "type": "shortText",
      "aliasId": "repeatNumbering",
      "pageNum": 1
    },
    {
      "id": "castoc7a10009d5111ebb14a83c829c69143",
      "icon": "IconText",
      "name": "Outro Top",
      "rect": [
        [24.36, 759.94],
        [133.81, 759.94],
        [133.81, 719.24],
        [24.36, 719.24]
      ],
      "type": "shortText",
      "aliasId": "outroTop",
      "pageNum": 2
    },
    {
      "id": "castof007e809d5111ebb14a83c829c69143",
      "icon": "IconText",
      "name": "Outro Bottom",
      "rect": [
        [426.7, 82.88],
        [559.9, 82.88],
        [559.9, 35.71],
        [426.7, 35.71]
      ],
      "type": "shortText",
      "aliasId": "outroBottom",
      "pageNum": 2
    },
    {
      "id": "casto22d56c0a3a111eba178fd84dbfb5d45",
      "icon": "IconText",
      "name": "Outro Page Numbering",
      "rect": [
        [440.18, 766.5],
        [513.03, 766.5],
        [513.03, 748.9],
        [440.18, 748.9]
      ],
      "type": "shortText",
      "aliasId": "pageNumbering",
      "pageNum": 2
    },
    {
      "id": "castoe6f60d0a3a111eba178fd84dbfb5d45",
      "icon": "IconText",
      "name": "Outro Repeat Numbering",
      "rect": [
        [529.43, 769.54],
        [602.89, 769.54],
        [602.89, 752.53],
        [529.43, 752.53]
      ],
      "type": "shortText",
      "aliasId": "repeatNumbering",
      "pageNum": 2
    },
  ],
  "pageSizes": [
    {
      "width": 612,
      "height": 792,
      "rotation": 0
    },
    {
      "width": 612,
      "height": 792,
      "rotation": 0
    },
    {
      "width": 612,
      "height": 792,
      "rotation": 0
    }
  ]
}
